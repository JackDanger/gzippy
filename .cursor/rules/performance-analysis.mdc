---
description: CI-driven performance workflow — CI is the source of truth, not local benchmarks
alwaysApply: true
---

# Performance Workflow: CI Is the Source of Truth

## Core Principle

**Never trust local benchmarks for final decisions.** GHA CI runs on both x86_64 (EPYC)
and arm64 (Graviton) with all datasets, archive types, thread configs, and competitors.
Local runs are useful for rapid iteration but CI is authoritative.

## The Loop

```
gzippy-dev ci triage          # 1. What gaps remain?
# ... make ONE focused code change ...
gzippy-dev ci push            # 2. Push → CI → auto-triage + vs-main
gzippy-dev ci vs-main         # 3. Check anytime: did branch help or hurt?
```

## When to Use Local Benchmarks

Only for rapid iteration before pushing:
- `gzippy-dev instrument file.gz` to understand timing breakdown
- `gzippy-dev path file.gz` to confirm which code path runs
- `gzippy-dev bench` for quick sanity checks

**Never claim a win/loss based on local results alone.**

## Gap Categories (from `ci triage`)

| Category | What it means | Action |
|---|---|---|
| ARCHITECTURE | Needs parallel single-member (rapidgzip-style pipeline) | Major feature, not micro-opt |
| SIMD | igzip's AVX2/AVX-512 hand-tuned assembly | Accept or write asm |
| ACTIONABLE | Closable with code changes | Work on these |
| NOISE | <2% — measurement variance | Ignore |

## CI Benchmark Architecture

**Platforms**: x86_64 (EPYC 4-core), arm64 (Graviton 4-core)
**Datasets**: silesia (211MB), software (~22MB), logs (~22MB)
**Archives**: gzip, bgzf, pigz — thread configs T1 and Tmax (4)
**Convergence**: min 10, max 40 trials, target CV <3%
**arm64 caveat**: CV 0.2-0.3 on small files, >10% swings between runs are noise

## Key devtool Commands

| Command | When to use |
|---|---|
| `ci triage` | Start of any optimization session |
| `ci push` | After code change — pushes, watches CI, auto-triages + compares vs main |
| `ci vs-main` | Quick check: how does branch compare to main right now? |
| `ci history --limit 10` | Is win rate trending up or down? |
| `ci compare ID_A ID_B` | Deep dive between specific runs |
| `instrument file.gz` | Understand where time goes in a specific file |
| `path file.gz` | Confirm which decompression code path runs |
